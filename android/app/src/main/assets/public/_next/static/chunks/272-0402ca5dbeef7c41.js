"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[272],{1860:(e,t,r)=>{r.d(t,{AppProvider:()=>p,B:()=>c});var i=r(5155),s=r(2115),n=r(1929),a=r(5894),o=r(8042),l=r(5742),u=r(9708);let d={darkMode:!1,textSize:"normal",smartQuantities:[{itemName:"Eggs",quantities:[6,12,18]},{itemName:"Water",quantities:[6,12,24]}],storePresets:["שופרסל","חצי חינם","רמי לוי","אושר עד"]},c=(0,s.createContext)(null);function p(e){let{children:t}=e,{firestore:r}=(0,o.useFirebase)(),{user:p,isUserLoading:f}=(0,o.useUser)(),{toast:m}=(0,a.dj)(),[h,g]=(0,s.useState)(d),[b,v]=(0,s.useState)({type:"lists"}),[S,y]=(0,s.useState)(!1),[E,I]=(0,s.useState)(null),[A,w]=(0,s.useState)(null),[D,M]=(0,s.useState)([]),[T,_]=(0,s.useState)([]),F=(0,o.useMemoFirebase)(()=>p?(0,u.P)((0,u.rJ)(r,"lists"),(0,u._M)("ownerId","==",p.uid)):null,[r,p]),k=(0,o.useMemoFirebase)(()=>p?(0,u.P)((0,u.rJ)(r,"lists"),(0,u._M)("collaborators","array-contains",p.uid)):null,[r,p]),C=(0,o.useMemoFirebase)(()=>p?(0,u.P)((0,u.rJ)(r,"recipes"),(0,u._M)("ownerId","==",p.uid)):null,[r,p]),L=(0,o.useMemoFirebase)(()=>p?(0,u.P)((0,u.rJ)(r,"recipes"),(0,u._M)("collaborators","array-contains",p.uid)):null,[r,p]),N=(0,o.useMemoFirebase)(()=>p?(0,u.rJ)(r,"users"):null,[r,p]),P=(0,o.useMemoFirebase)(()=>p?(0,u.H9)(r,"users",p.uid,"settings","app_settings"):null,[r,p]),{data:O,isLoading:U}=(0,o.useDoc)(P),{data:x,isLoading:R}=(0,o.useCollection)(F),{data:q,isLoading:H}=(0,o.useCollection)(k),{data:j,isLoading:J}=(0,o.useCollection)(C),{data:B,isLoading:z}=(0,o.useCollection)(L),{data:$,isLoading:Q}=(0,o.useCollection)(N),V=(0,s.useMemo)(()=>{let e=new Map;return(x||[]).forEach(t=>e.set(t.id,t)),(q||[]).forEach(t=>e.set(t.id,t)),Array.from(e.values())},[x,q]),K=(0,s.useMemo)(()=>{let e=new Map;return(j||[]).forEach(t=>e.set(t.id,t)),(B||[]).forEach(t=>e.set(t.id,t)),Array.from(e.values())},[j,B]);(0,s.useEffect)(()=>{$&&_($)},[$]),(0,s.useEffect)(()=>{p?null!==O||U?O&&g(e=>({...e,...O})):((0,l.wu)(P,d,{merge:!0}),g(d)):g(d)},[O,U,p,P]);let W=R||H||J||z||Q||f||U,G=b.type.includes("list")?"lists":b.type.includes("recipe")?"recipes":"settings",X=(0,s.useCallback)(()=>{navigator.vibrate&&navigator.vibrate(10)},[]),Y=e=>{X(),v(e)},Z=async e=>{try{let t=await fetch("/api/process-item",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.name,qty:e.qty,unit:e.unit})});if(!t.ok){let e=await t.json();throw Error(e.error||"API request failed with status ".concat(t.status))}let r=await t.json();return{...e,...r}}catch(t){return console.error("AI item processing failed:",t),m({variant:"destructive",title:"AI Error",description:"Could not process item."}),{...e,name:e.name,canonicalName:e.name,category:e.category||"Other",icon:e.icon||"\uD83D\uDED2"}}},ee=(e,t)=>{let i=V.find(t=>t.id===e);if(!i)return;let s={...t,id:(0,n.A)(),checked:!1,notes:(t.notes||"").trim(),store:(t.store||"").trim()},a=[...i.items,s];(0,l.pt)((0,u.H9)(r,"lists",e),{items:a})},et=(e,t,i)=>{let s=V.find(t=>t.id===e);if(!s)return;let n=s.items.map(e=>e.id===t.id?{...e,name:t.name,qty:e.qty+i.qty,urgent:e.urgent||i.urgent,store:(t.store||i.store||"").trim()}:e);(0,l.pt)((0,u.H9)(r,"lists",e),{items:n})},er=(0,s.useCallback)(()=>{if(A||0===D.length)return;let[e,...t]=D;M(t);let{listId:r,skipProcessing:i,...s}=e;(async()=>{let e=i?{...s,name:s.name,canonicalName:s.name,category:s.category||"Other",icon:s.icon||"\uD83D\uDED2"}:await Z(s),t=V.find(e=>e.id===r);if(!t)return;let n=(e.notes||"").trim(),a=(e.store||"").trim(),o=t.items.find(t=>!t.checked&&t.canonicalName===e.canonicalName&&t.unit===e.unit&&(t.notes||"").trim()===n&&(t.store||"").trim()===a);if(o){et(r,o,e),er();return}let l=t.items.find(t=>!t.checked&&t.canonicalName===e.canonicalName&&t.unit===e.unit&&(t.notes||"").trim()===n&&(!!(t.store||"").trim()&&!a||!(t.store||"").trim()&&!!a));if(l)return w({existingItem:l,newItemData:e,listId:r});ee(r,e),er()})()},[D,A,V,m]);(0,s.useEffect)(()=>{D.length>0&&!A&&er()},[D,A,er]);let ei=async(e,t,i)=>{let s=T.find(e=>e.email===i);if(!s)return m({variant:"destructive",title:"User not found"}),!1;let n="list"===e?V.find(e=>e.id===t):K.find(e=>e.id===t);if(n&&!n.collaborators.includes(s.uid)){let i=[...n.collaborators,s.uid];return(0,l.pt)((0,u.H9)(r,"list"===e?"lists":"recipes",t),{collaborators:i}),m({title:"Collaborator Added"}),!0}return!1};return(0,i.jsx)(c.Provider,{value:{lists:V,recipes:K,settings:h,isDataLoading:W,currentView:b,activeTab:G,urgentMode:S,generatedRecipe:E,mergeProposal:A,users:T,navigate:Y,vibrate:X,addList:(e,t)=>{if(!p)return;X();let i={name:e,icon:t,items:[],ownerId:p.uid,collaborators:[]};(0,l.BH)((0,u.rJ)(r,"lists"),i).then(e=>{e&&Y({type:"listDetail",listId:e.id})})},updateList:(e,t,i)=>{X(),(0,l.pt)((0,u.H9)(r,"lists",e),{name:t,icon:i})},deleteList:e=>{X(),(0,l.zb)((0,u.H9)(r,"lists",e)),Y({type:"lists"})},addItemToList:function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];M(i=>[...i,{...t,listId:e,skipProcessing:r}])},addSmartItemToList:(e,t)=>{M(r=>[...r,{...t,listId:e}])},updateItemInList:(e,t)=>{X();let i=V.find(t=>t.id===e);if(!i)return;let s=i.items.filter(e=>e.id!==t.id);(0,l.pt)((0,u.H9)(r,"lists",e),{items:s});let{id:n,checked:a,...o}=t;M(t=>[...t,{...o,listId:e}])},deleteItemInList:(e,t)=>{X();let i=V.find(t=>t.id===e);if(!i)return;let s=i.items.filter(e=>e.id!==t);(0,l.pt)((0,u.H9)(r,"lists",e),{items:s})},toggleItemChecked:(e,t)=>{X();let i=V.find(t=>t.id===e);if(!i)return;let s=i.items.map(e=>e.id===t?{...e,checked:!e.checked}:e);(0,l.pt)((0,u.H9)(r,"lists",e),{items:s})},setUrgentMode:y,addRecipe:e=>{if(!p)return;X();let t={...e,ownerId:p.uid,collaborators:[]};(0,l.BH)((0,u.rJ)(r,"recipes"),t).then(e=>{e&&Y({type:"recipeDetail",recipeId:e.id})})},updateRecipe:e=>{X(),(0,l.pt)((0,u.H9)(r,"recipes",e.id),e),Y({type:"recipeDetail",recipeId:e.id})},deleteRecipe:e=>{X(),(0,l.zb)((0,u.H9)(r,"recipes",e)),Y({type:"recipes"})},addRecipeToList:(e,t)=>{X();let r=K.find(t=>t.id===e);if(!r)return;let i=r.ingredients.map(e=>({...e,listId:t,skipProcessing:!0}));M(e=>[...e,...i]),m({title:"Recipe Added",description:"Ingredients from ".concat(r.name," will be added to your list.")}),Y({type:"listDetail",listId:t})},updateSettings:e=>{if(!P)return;X();let t={...h,...e};g(t),(0,l.wu)(P,t,{merge:!0})},setGeneratedRecipe:I,clearGeneratedRecipe:()=>I(null),confirmMerge:()=>{if(!A)return;let{listId:e,existingItem:t,newItemData:r}=A;et(e,t,r),w(null),er()},declineMerge:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(!A)return;let{listId:t,newItemData:r}=A;e&&ee(t,r),w(null),er()},addCollaborator:ei,removeCollaborator:(e,t,i)=>{let s="list"===e?V.find(e=>e.id===t):K.find(e=>e.id===t);if(s){let n=s.collaborators.filter(e=>e!==i);(0,l.pt)((0,u.H9)(r,"list"===e?"lists":"recipes",t),{collaborators:n}),m({title:"Collaborator Removed"})}}},children:t})}},4269:(e,t,r)=>{r.d(t,{cn:()=>n});var i=r(2821),s=r(5889);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,i.$)(t))}},5742:(e,t,r)=>{r.d(t,{BH:()=>o,pt:()=>l,wu:()=>a,zb:()=>u});var i=r(9708),s=r(9891),n=r(6501);function a(e,t,r){(0,i.BN)(e,t,r).catch(r=>{s.d.emit("permission-error",new n.$({path:e.path,operation:"write",requestResourceData:t}))})}function o(e,t){return(0,i.gS)(e,t).catch(r=>{s.d.emit("permission-error",new n.$({path:e.path,operation:"create",requestResourceData:t}))})}function l(e,t){(0,i.mZ)(e,t).catch(r=>{s.d.emit("permission-error",new n.$({path:e.path,operation:"update",requestResourceData:t}))})}function u(e){(0,i.kd)(e).catch(t=>{s.d.emit("permission-error",new n.$({path:e.path,operation:"delete"}))})}},5894:(e,t,r)=>{r.d(t,{dj:()=>c});var i=r(2115);let s=0,n=new Map,a=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),u({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},o=[],l={toasts:[]};function u(e){l=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?a(r):e.toasts.forEach(e=>{a(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(l,e),o.forEach(e=>{e(l)})}function d(e){let{...t}=e,r=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),i=()=>u({type:"DISMISS_TOAST",toastId:r});return u({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||i()}}}),{id:r,dismiss:i,update:e=>u({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function c(){let[e,t]=i.useState(l);return i.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:d,dismiss:e=>u({type:"DISMISS_TOAST",toastId:e})}}},6501:(e,t,r)=>{r.d(t,{$:()=>s});var i=r(9253);class s extends Error{constructor(e){let t=function(e){let t=null;try{let e=(0,i.xI)().currentUser;e&&(t=function(e){var t;if(!e)return null;let r={name:e.displayName,email:e.email,email_verified:e.emailVerified,phone_number:e.phoneNumber,sub:e.uid,firebase:{identities:e.providerData.reduce((e,t)=>(t.providerId&&(e[t.providerId]=[t.uid]),e),{}),sign_in_provider:(null==(t=e.providerData[0])?void 0:t.providerId)||"custom",tenant:e.tenantId}};return{uid:e.uid,token:r}}(e))}catch(e){}return{auth:t,method:e.operation,path:"/databases/(default)/documents/".concat(e.path),resource:e.requestResourceData?{data:e.requestResourceData}:void 0}}(e);super("Missing or insufficient permissions: The following request was denied by Firestore Security Rules:\n".concat(JSON.stringify(t,null,2))),this.name="FirebaseError",this.request=t}}},8042:(e,t,r)=>{r.r(t),r.d(t,{FirebaseClientProvider:()=>S,FirebaseContext:()=>c,FirebaseProvider:()=>p,FirestorePermissionError:()=>y.$,addDocumentNonBlocking:()=>A.BH,deleteDocumentNonBlocking:()=>A.zb,errorEmitter:()=>u.d,getSdks:()=>_,initializeFirebase:()=>T,initiateAnonymousSignIn:()=>w,initiateEmailSignIn:()=>M,initiateEmailSignUp:()=>D,setDocumentNonBlocking:()=>A.wu,updateDocumentNonBlocking:()=>A.pt,useAuth:()=>m,useCollection:()=>E,useDoc:()=>I,useFirebase:()=>f,useFirebaseApp:()=>g,useFirestore:()=>h,useMemoFirebase:()=>b,useUser:()=>v});let i={projectId:"studio-8618186014-74886",appId:"1:984337619270:web:7a79a2cbea09bec0d2ad47",apiKey:"AIzaSyDFgIbRfLKJvNtsU0c7uTBD-AtfuSoyJVY",authDomain:"studio-8618186014-74886.firebaseapp.com",measurementId:"",messagingSenderId:"984337619270"};var s=r(2078),n=r(9253),a=r(9708),o=r(5155),l=r(2115),u=r(9891);function d(){let[e,t]=(0,l.useState)(null);if((0,l.useEffect)(()=>{let e=e=>{t(e)};return u.d.on("permission-error",e),()=>{u.d.off("permission-error",e)}},[]),e)throw e;return null}let c=(0,l.createContext)(void 0),p=e=>{let{children:t,firebaseApp:r,firestore:i,auth:s}=e,[a,u]=(0,l.useState)({user:null,isUserLoading:!0,userError:null});(0,l.useEffect)(()=>{if(!s)return void u({user:null,isUserLoading:!1,userError:Error("Auth service not provided.")});u({user:null,isUserLoading:!0,userError:null});let e=(0,n.hg)(s,e=>{u({user:e,isUserLoading:!1,userError:null})},e=>{console.error("FirebaseProvider: onAuthStateChanged error:",e),u({user:null,isUserLoading:!1,userError:e})});return()=>e()},[s]);let p=(0,l.useMemo)(()=>{let e=!!(r&&i&&s);return{areServicesAvailable:e,firebaseApp:e?r:null,firestore:e?i:null,auth:e?s:null,user:a.user,isUserLoading:a.isUserLoading,userError:a.userError}},[r,i,s,a]);return(0,o.jsxs)(c.Provider,{value:p,children:[(0,o.jsx)(d,{}),t]})},f=()=>{let e=(0,l.useContext)(c);if(void 0===e)throw Error("useFirebase must be used within a FirebaseProvider.");if(!e.areServicesAvailable||!e.firebaseApp||!e.firestore||!e.auth)throw Error("Firebase core services not available. Check FirebaseProvider props.");return{firebaseApp:e.firebaseApp,firestore:e.firestore,auth:e.auth,user:e.user,isUserLoading:e.isUserLoading,userError:e.userError}},m=()=>{let{auth:e}=f();return e},h=()=>{let{firestore:e}=f();return e},g=()=>{let{firebaseApp:e}=f();return e};function b(e,t){let r=(0,l.useMemo)(e,t);return"object"!=typeof r||null===r||(r.__memo=!0),r}let v=()=>{let{user:e,isUserLoading:t,userError:r}=f();return{user:e,isUserLoading:t,userError:r}};function S(e){let{children:t}=e,r=(0,l.useMemo)(()=>T(),[]);return(0,o.jsx)(p,{firebaseApp:r.firebaseApp,auth:r.auth,firestore:r.firestore,children:t})}var y=r(6501);function E(e){let[t,r]=(0,l.useState)(null),[i,s]=(0,l.useState)(!1),[n,o]=(0,l.useState)(null);if((0,l.useEffect)(()=>{if(!e){r(null),s(!1),o(null);return}s(!0),o(null);let t=(0,a.aQ)(e,e=>{let t=[];for(let r of e.docs)t.push({...r.data(),id:r.id});r(t),o(null),s(!1)},t=>{let i="collection"===e.type?e.path:e._query.path.canonicalString(),n=new y.$({operation:"list",path:i});o(n),r(null),s(!1),u.d.emit("permission-error",n)});return()=>t()},[e]),e&&!e.__memo)throw Error(e+" was not properly memoized using useMemoFirebase");return{data:t,isLoading:i,error:n}}function I(e){let[t,r]=(0,l.useState)(null),[i,s]=(0,l.useState)(!1),[n,o]=(0,l.useState)(null);return(0,l.useEffect)(()=>{if(!e){r(null),s(!1),o(null);return}s(!0),o(null);let t=(0,a.aQ)(e,e=>{e.exists()?r({...e.data(),id:e.id}):r(null),o(null),s(!1)},t=>{let i=new y.$({operation:"get",path:e.path});o(i),r(null),s(!1),u.d.emit("permission-error",i)});return()=>t()},[e]),{data:t,isLoading:i,error:n}}var A=r(5742);function w(e){(0,n.zK)(e)}function D(e,t,r){(0,n.eJ)(e,t,r)}function M(e,t,r){(0,n.x9)(e,t,r)}function T(){if(!(0,s.Dk)().length){let e;try{e=(0,s.Wp)()}catch(t){console.warn("Automatic initialization failed. Falling back to firebase config object.",t),e=(0,s.Wp)(i)}return _(e)}return _((0,s.Sx)())}function _(e){return{firebaseApp:e,auth:(0,n.xI)(e),firestore:(0,a.aU)(e)}}},9891:(e,t,r)=>{r.d(t,{d:()=>i});let i=function(){let e={};return{on(t,r){var i;e[t]||(e[t]=[]),null==(i=e[t])||i.push(r)},off(t,r){var i;e[t]&&(e[t]=null==(i=e[t])?void 0:i.filter(e=>e!==r))},emit(t,r){var i;e[t]&&(null==(i=e[t])||i.forEach(e=>e(r)))}}}()}}]);