{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User Profile",
      "type": "object",
      "description": "Represents a user's public profile.",
      "properties": {
        "uid": { "type": "string", "description": "The user's unique ID from Firebase Authentication." },
        "name": { "type": "string", "description": "The user's display name." },
        "email": { "type": "string", "format": "email", "description": "The user's email address." },
        "photoURL": { "type": "string", "format": "uri", "description": "URL for the user's profile picture." }
      },
      "required": ["uid", "name", "email"]
    },
    "Item": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Item",
      "type": "object",
      "description": "Represents an item in a shopping list or a recipe.",
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string" },
        "canonicalName": { "type": "string" },
        "category": { "type": "string" },
        "qty": { "type": "number" },
        "unit": { "type": "string" },
        "urgent": { "type": "boolean" },
        "icon": { "type": "string" },
        "store": { "type": "string" },
        "notes": { "type": "string" },
        "checked": { "type": "boolean" },
        "gf": { "type": "boolean" }
      },
      "required": ["id", "name", "qty", "checked"]
    },
    "List": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "List",
      "type": "object",
      "description": "Represents a collaborative shopping list.",
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string" },
        "icon": { "type": "string" },
        "ownerId": { "type": "string", "description": "The UID of the user who owns the list." },
        "collaborators": {
          "type": "array",
          "description": "An array of UIDs of users who can collaborate on the list.",
          "items": { "type": "string" }
        },
        "items": {
          "type": "array",
          "items": { "$ref": "#/backend/entities/Item" }
        }
      },
      "required": ["id", "name", "ownerId", "collaborators", "items"]
    },
    "Recipe": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Recipe",
      "type": "object",
      "description": "Represents a collaborative recipe.",
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string" },
        "icon": { "type": "string" },
        "image": { "type": "string", "format": "uri" },
        "ownerId": { "type": "string", "description": "The UID of the user who owns the recipe." },
        "collaborators": {
          "type": "array",
          "description": "An array of UIDs of users who can collaborate on the recipe.",
          "items": { "type": "string" }
        },
        "ingredients": {
          "type": "array",
          "items": { "$ref": "#/backend/entities/Item" }
        }
      },
      "required": ["id", "name", "ownerId", "collaborators", "ingredients"]
    },
    "Settings": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Settings",
      "type": "object",
      "description": "Represents a user's application settings.",
      "properties": {
        "darkMode": { "type": "boolean" },
        "textSize": { "type": "string", "enum": ["normal", "large"] },
        "smartQuantities": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "itemName": { "type": "string" },
              "quantities": { "type": "array", "items": { "type": "number" } }
            },
            "required": ["itemName", "quantities"]
          }
        },
        "storePresets": {
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "required": ["darkMode", "textSize", "smartQuantities", "storePresets"]
    }
  },
  "auth": {
    "providers": [
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": { "$ref": "#/backend/entities/UserProfile" },
          "description": "Stores user profiles. The document ID 'userId' corresponds to the Firebase Auth UID."
        }
      },
      {
        "path": "/users/{userId}/settings/{settingsId}",
        "definition": {
          "entityName": "Settings",
          "schema": { "$ref": "#/backend/entities/Settings" },
          "description": "Stores user-specific application settings. settingsId is a singleton document, e.g., 'app_settings'."
        }
      },
      {
        "path": "/lists/{listId}",
        "definition": {
          "entityName": "List",
          "schema": { "$ref": "#/backend/entities/List" },
          "description": "Root collection for all shopping lists. Access is controlled by 'ownerId' and the 'collaborators' array within each document."
        }
      },
      {
        "path": "/recipes/{recipeId}",
        "definition": {
          "entityName": "Recipe",
          "schema": { "$ref": "#/backend/entities/Recipe" },
          "description": "Root collection for all recipes. Access is controlled by 'ownerId' and the 'collaborators' array within each document."
        }
      }
    ],
    "reasoning": "The Firestore data structure is flattened to support direct queries for collaborative features. Lists and recipes are stored in root collections, and security is managed at the document level using 'ownerId' and a 'collaborators' array. This structure allows the application to efficiently query for all lists/recipes a user owns or is a collaborator on in two separate queries, which are then merged on the client. User profiles are stored in a separate root collection, accessible for displaying collaborator information. User settings are stored in a subcollection under the user's profile."
  }
}
